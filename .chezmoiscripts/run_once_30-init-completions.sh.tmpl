{{ template "shebang-bash.tmpl" . }}
# Initialize shell completions for various tools
# This script runs only once during initial setup
# This script is refactored to use common libraries

set -e

# Include common libraries
{{ template "lib-logging.sh.tmpl" . }}

log_info "Initializing shell completions..."

# Check if make is available
if ! check_command make; then
    log_warning "make is not installed, skipping completion initialization"
    exit 0
fi

# Run make update-completions from chezmoi source directory
CHEZMOI_SOURCE_DIR="{{ .chezmoi.sourceDir }}"

if [[ -f "$CHEZMOI_SOURCE_DIR/Makefile" ]]; then
    log_running "Running make update-completions..."
    cd "$CHEZMOI_SOURCE_DIR"

    if make update-completions; then
        log_success "Shell completions initialization completed"
        log_info "To update completions in the future, run: make update-completions"
    else
        log_error "Failed to update completions"
        exit 1
    fi
else
    log_error "Makefile not found in chezmoi source directory"
    exit 1
fi
